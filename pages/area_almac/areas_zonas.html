<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Áreas y Zonas de Almacén</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../../styles/Area_almac/areas_zonas.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js" defer></script>
  <script src="../../scripts/reports/report-history-client.js" defer></script>
  <script src="../../scripts/utils/report_export.js" defer></script>
  <script src="../../scripts/area_almac/areas_zonas.js" defer></script>
</head>
<body>
  <div class="warehouse-page container-fluid py-4 px-3 px-md-4">
    <section class="page-header">
      <span class="header-eyebrow">Infraestructura</span>
      <h1 class="header-title">Áreas y zonas de almacén</h1>
      <p class="header-description">
        Diseña el mapa de tu centro logístico con el mismo lenguaje visual del panel administrativo para ubicar áreas, zonas y subniveles con claridad.
      </p>

      <div class="header-highlights">
        <article class="highlight-card">
          <span class="card-label">Áreas activas</span>
          <strong class="card-title" id="totalAreas">0</strong>
          <span class="card-subtitle">Espacios principales definidos</span>
        </article>
        <article class="highlight-card">
          <span class="card-label">Zonas creadas</span>
          <strong class="card-title" id="totalZonas">0</strong>
          <span class="card-subtitle">Segmentos operativos</span>
        </article>
        <article class="highlight-card">
          <span class="card-label">Zonas sin área</span>
          <strong class="card-title" id="zonasSinArea">0</strong>
          <span class="card-subtitle">Pendientes de asignar</span>
        </article>
      </div>
    </section>

    <section class="warehouse-shell">
      <div class="shell-header">
        <div class="shell-header__info">
          <span class="shell-eyebrow">Mapa logístico</span>
          <h2 class="shell-title">Controla ubicaciones y espacios del almacén</h2>
          <p class="shell-subtitle">Registra áreas, zonas y subniveles desde un entorno visual coherente con el resto de herramientas de OptiStock.</p>
        </div>
        <div class="shell-header__actions">
          <button class="shell-action shell-action--primary" onclick="mostrarFormulario('area')">Registrar nueva área</button>
          <button class="shell-action" onclick="mostrarFormulario('zona')">Registrar nueva zona</button>
        </div>
      </div>

      <div class="shell-grid">
        <section class="summary-card" aria-labelledby="resumenPanel">
          <header class="summary-header">
            <span class="summary-eyebrow">Vista general</span>
            <h3 id="resumenPanel" class="summary-title">Resumen del almacén</h3>
            <p class="summary-description">Consulta rápidamente qué áreas existen, sus zonas asociadas y los detalles relevantes de cada una.</p>
          </header>
          <div id="registroLista" class="resumen-contenedor">
            <p class="vacio">No hay áreas ni zonas registradas.</p>
          </div>
        </section>

        <section class="forms-card">
          <div id="error-message" class="form-error" role="alert"></div>

          <form id="areaForm" class="formulario" style="display:none" autocomplete="off">
            <h4>Registrar área de almacén</h4>
            <div class="form-group">
              <label for="areaName">Nombre del área</label>
              <input type="text" name="areaName" id="areaName" placeholder="Nombre del área" required />
            </div>
            <div class="form-group">
              <label for="areaDesc">Descripción</label>
              <textarea id="areaDesc" name="areaDesc" rows="3" placeholder="Uso o características del área" required></textarea>
            </div>
            <div class="form-group">
              <label>Dimensiones físicas (m)</label>
              <div class="dimension-row">
                <input type="number" name="areaWidth" id="areaWidth" placeholder="Ancho" min="0.01" step="0.01" required />
                <input type="number" name="areaHeight" id="areaHeight" placeholder="Alto" min="0.01" step="0.01" required />
                <input type="number" name="areaLength" id="areaLength" placeholder="Largo" min="0.01" step="0.01" required />
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="shell-action shell-action--primary">Guardar área</button>
            </div>
          </form>

          <form id="zoneForm" class="formulario" style="display:none" autocomplete="off">
            <h4>Registrar zona de almacenamiento</h4>
            <div class="form-group">
              <label for="zoneName">Nombre de la zona</label>
              <input type="text" id="zoneName" name="zoneName" placeholder="Nombre de la zona" required />
            </div>
            <div class="form-group">
              <label for="zoneDesc">Descripción</label>
              <textarea id="zoneDesc" name="zoneDesc" rows="3" placeholder="Uso específico o notas" required></textarea>
            </div>
            <div class="form-group">
              <label for="zoneArea">Área asociada</label>
              <select name="zoneArea" id="zoneArea" required>
                <option value="">Seleccione un área</option>
              </select>
            </div>
            <div class="form-group">
              <label>Dimensiones físicas (m)</label>
              <div class="dimension-row">
                <input type="number" id="zoneWidth" name="zoneWidth" placeholder="Ancho" min="0.01" step="0.01" required />
                <input type="number" id="zoneHeight" name="zoneHeight" placeholder="Alto" min="0.01" step="0.01" required />
                <input type="number" id="zoneLength" name="zoneLength" placeholder="Largo" min="0.01" step="0.01" required />
              </div>
            </div>
            <div class="form-group">
              <label for="sublevelsCount">Cantidad de subniveles</label>
              <input type="number" name="sublevelsCount" id="sublevelsCount" min="0" step="1" value="0" />
            </div>
            <div id="sublevelsContainer" class="sublevels-container"></div>
            <div class="form-group">
              <label for="storageType">Tipo de almacenamiento</label>
              <select name="storageType" id="storageType" required>
                <option value="">Seleccione una opción</option>
                <option value="estanteria">Estantería</option>
                <option value="piso">Piso</option>
                <option value="refrigeracion">Refrigeración</option>
              </select>
            </div>
            <div class="form-actions">
              <button type="submit" class="shell-action shell-action--primary">Guardar zona</button>
            </div>
          </form>
        </section>
      </div>

      <section class="inventory-status" aria-labelledby="inventarioTitulo">
        <header class="inventory-header">
          <div>
            <span class="inventory-eyebrow">Monitoreo de productos</span>
            <h3 id="inventarioTitulo">Productos almacenados por área y zona</h3>
            <p class="inventory-description">
              El listado se actualiza automáticamente para impedir que elimines ubicaciones con productos activos sin reasignarlos primero.
            </p>
            <div class="inventory-safety-note" role="note">
              <span class="note-indicator" aria-hidden="true">&#9432;</span>
              <p class="note-message">
                El sistema asegura que las zonas eliminadas permiten la reasignación de los productos almacenados a otras zonas disponibles antes de proceder con la eliminación.
              </p>
            </div>
          </div>
          <div class="inventory-controls">
            <label class="inventory-filter">
              <span>Filtrar áreas</span>
              <select id="areaFilter">
                <option value="todas">Todas</option>
                <option value="con">Con productos activos</option>
                <option value="sin">Sin productos activos</option>
              </select>
            </label>
            <label class="inventory-filter">
              <span>Filtrar zonas</span>
              <select id="zonaFilter">
                <option value="todas">Todas</option>
                <option value="con">Con productos activos</option>
                <option value="sin">Sin productos activos</option>
              </select>
            </label>
          </div>
        </header>

        <div class="inventory-tables">
          <article class="inventory-table" aria-labelledby="tablaAreasTitulo">
            <header class="inventory-table__header">
              <h4 id="tablaAreasTitulo">Áreas registradas</h4>
              <div class="table-toolbar" role="group" aria-label="Exportar áreas registradas">
                <button type="button" class="btn-export btn-export--pdf" id="exportAreasPdf">PDF</button>
                <button type="button" class="btn-export btn-export--excel" id="exportAreasExcel">Excel</button>
              </div>
            </header>
            <table id="tablaAreasRegistradas">
              <thead>
                <tr>
                  <th scope="col">Área</th>
                  <th scope="col">Zonas vinculadas</th>
                  <th scope="col">Productos activos</th>
                  <th scope="col">Dimensiones (m)</th>
                </tr>
              </thead>
              <tbody id="areasInventoryBody">
                <tr class="empty-row">
                  <td colspan="4">Los datos del inventario se mostrarán aquí.</td>
                </tr>
              </tbody>
            </table>
          </article>

          <article class="inventory-table" aria-labelledby="tablaZonasTitulo">
            <header class="inventory-table__header">
              <h4 id="tablaZonasTitulo">Zonas registradas</h4>
              <div class="table-toolbar" role="group" aria-label="Exportar zonas registradas">
                <button type="button" class="btn-export btn-export--pdf" id="exportZonasPdf">PDF</button>
                <button type="button" class="btn-export btn-export--excel" id="exportZonasExcel">Excel</button>
              </div>
            </header>
            <table id="tablaZonasRegistradas">
              <thead>
                <tr>
                  <th scope="col">Zona</th>
                  <th scope="col">Área asociada</th>
                  <th scope="col">Productos activos</th>
                  <th scope="col">Dimensiones (m)</th>
                </tr>
              </thead>
              <tbody id="zonasInventoryBody">
                <tr class="empty-row">
                  <td colspan="4">Las zonas activas aparecerán aquí.</td>
                </tr>
              </tbody>
            </table>
          </article>
        </div>
      </section>
    </section>
  </div>

  <div id="reasignacionOverlay" class="reasignacion-overlay" hidden>
    <div class="reasignacion-dialog" role="dialog" aria-modal="true" aria-labelledby="reasignacionTitulo">
      <h3 id="reasignacionTitulo">Reasignar productos de la zona</h3>
      <p id="reasignacionMensaje"></p>
      <label class="visually-hidden" for="reasignacionSelect">Selecciona la zona destino</label>
      <select id="reasignacionSelect"></select>
      <p id="reasignacionError" class="reasignacion-error" role="alert"></p>
      <div class="reasignacion-actions">
        <button id="confirmarReasignacion" class="shell-action shell-action--primary">Reasignar y eliminar</button>
        <button id="cancelarReasignacion" class="shell-action">Cancelar</button>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</body>
</html>
